#ifndef __WSP_HTM_H__
#define __WSP_HTM_H__

#include <linux/types.h>

/*
 * Register definitions. Some of these are actually available to
 * user space via the enable ioctl
 */
#define NHTM_MODE_ENABLE			0x8000000000000000ull
#define NHTM_MODE_CONTENT_SEL_MASK		0x6000000000000000ull
#define NHTM_MODE_CONTENT_SEL_FABRIC		0x0000000000000000ull
#define NHTM_MODE_WRITE_TTYPE			0x1000000000000000ull
#define NHTM_MODE_CAPTURE_MASK			0x0fc0000000000000ull
#define NHTM_MODE_CAPTURE_HTM_GEN_WRITE		0x0800000000000000ull
#define NHTM_MODE_CAPTURE_FILTER_PMISC_AND_HANG	0x0400000000000000ull
#define NHTM_MODE_CAPTURE_CRESP_IGNORE		0x0300000000000000ull
#define NHTM_MODE_CAPTURE_CRESP_PIPE_LATCH	0x0200000000000000ull
#define NHTM_MODE_CAPTURE_CRESP_FLUSH_AT_3	0x0000000000000000ull
#define NHTM_MODE_CAPTURE_CRESP_FLUSH_AT_2	0x0100000000000000ull
#define NHTM_MODE_CAPTURE_PREALLOC_16_BUF	0x0000000000000000ull
#define NHTM_MODE_CAPTURE_PREALLOC_8_BUF	0x0080000000000000ull
#define NHTM_MODE_CAPTURE_ENABLE_CTAG_TRACE	0x0040000000000000ull
#define NHTM_MODE_CAPTURE_ENABLE_COPR_FILTER	0x0020000000000000ull
#define NHTM_MODE_CAPTURE_DEBUG_CRESP_CHTM	0x0010000000000000ull
#define NHTM_MODE_WRAP_MODE			0x0004000000000000ull
#define NHTM_MODE_DISABLE_TIME_STAMPS		0x0002000000000000ull
#define NHTM_MODE_SINGLE_TIME_STAMPS		0x0001000000000000ull
#define NHTM_MODE_DISABLE_AT_NODE_STALL		0x0000800000000000ull
#define NHTM_MODE_MARKER_ONLY_MODE		0x0000400000000000ull

#define NHTM_MODE_USER_MASK			0x0fffc00000000000ull

#define NHTM_MEM_TRACE_MEM_ALLOCATED		0x8000000000000000ull
#define NHTM_MEM_GLOBAL_SCOPE			0x4000000000000000ull
#define NHTM_MEM_LOCAL_SCOPE			0x0000000000000000ull
#define NHTM_MEM_BASE_ADDR_MASK			0x00003fffff000000ull
#define NHTM_MEM_SIZE_MASK			0x0000000000ff8000ull
#define NHTM_MEM_SIZE_16M			0x0000000000000000ull
#define NHTM_MEM_SIZE_32M			0x0000000000008000ull
#define NHTM_MEM_SIZE_64M			0x0000000000018000ull
#define NHTM_MEM_SIZE_128M			0x0000000000038000ull
#define NHTM_MEM_SIZE_256M			0x0000000000078000ull
#define NHTM_MEM_SIZE_512M			0x00000000000f8000ull
#define NHTM_MEM_SIZE_1G			0x00000000001f8000ull
#define NHTM_MEM_SIZE_2G			0x00000000003f8000ull
#define NHTM_MEM_SIZE_4G			0x00000000007f8000ull
#define NHTM_MEM_SIZE_8G			0x0000000000ff8000ull

#define NHTM_STAT_CRESP_QUEUE_OVERWRITE		0x2000000000000000ull
#define NHTM_STAT_ADDRESS_REPAIR		0x1000000000000000ull
#define NHTM_STAT_BUFFER_WAITING		0x0800000000000000ull
#define NHTM_STAT_OVERRUN_TRIG_STAMP_LOST	0x0400000000000000ull
#define NHTM_STAT_ERROR_STATE			0x0200000000000000ull
#define NHTM_STAT_OVERRUN_TRACE_DATA_LOST	0x0100000000000000ull
#define NHTM_STAT_INIT_STATE			0x0080000000000000ull
#define NHTM_STAT_PRE_REQ_STATE			0x0040000000000000ull
#define NHTM_STAT_READY_STATE			0x0020000000000000ull
#define NHTM_STAT_TRACING_STATE			0x0010000000000000ull
#define NHTM_STAT_PAUSED_STATE			0x0008000000000000ull
#define NHTM_STAT_FLUSH_STATE			0x0004000000000000ull
#define NHTM_STAT_COMPLETED_STATE		0x0002000000000000ull
#define NHTM_STAT_ENABLE_STATE			0x0001000000000000ull
#define NHTM_STAT_STAMP_STATE			0x0000800000000000ull
#define NHTM_STAT_SCOM_ERROR			0x0000400000000000ull
#define NHTM_LAST_LAST_ADDRESS_MASK		0x00003fffffffffc0ull

#define NHTM_TRIG_START				0x8000000000000000ull
#define NHTM_TRIG_STOP				0x4000000000000000ull
#define NHTM_TRIG_PAUSE				0x2000000000000000ull
#define NHTM_TRIG_STOP2				0x1000000000000000ull
#define NHTM_TRIG_RESET				0x0800000000000000ull
#define NHTM_TRIG_MARK_TYPE_VALID		0x0400000000000000ull
#define NHTM_TRIG_MARK_TYPE_MASK		0x03ff000000000000ull
#define NHTM_TRIG_MARK_TYPE_SHIFT		48

#define NHTM_CTRL_TRIGGER_CTRL_MASK		0xc000000000000000ull
#define NHTM_CTRL_TRIGGER_FWD_OFF_CTRL_ALL	0x0000000000000000ull
#define NHTM_CTRL_TRIGGER_FWD_OFF_CTRL_LOCAL	0x4000000000000000ull
#define NHTM_CTRL_TRIGGER_FWD_ON_CTRL_GLOBAL	0x8000000000000000ull
#define NHTM_CTRL_MARKER_CTRL_MASK		0x0c00000000000000ull
#define NHTM_CTRL_MARKER_FWD_OFF_TRACE_ALL	0x0000000000000000ull
#define NHTM_CTRL_MARKER_FWD_OFF_TRACE_LOCAL	0x0400000000000000ull
#define NHTM_CTRL_MARKER_FWD_ON_TRACE_GLOBAL	0x0800000000000000ull
#define NHTM_CTRL_MARKER_FWD_ON_TRACE_NONE	0x0c00000000000000ull

#define NHTM_FILT_TTAG_PATTERN_MASK		0xfff0000000000000ull
#define NHTM_FILT_TTAG_PATTERN_SHIFT		52
#define NHTM_FILT_GLOBAL_VS_NODAL_PATTERN	0x0008000000000000ull
#define NHTM_FILT_TTAG_MASK_MASK		0x0000fff000000000ull
#define NHTM_FILT_TTAG_MASK_SHIFT		36
#define NHTM_FILT_GLOBAL_VS_NODAL_FILTER	0x0000000800000000ull

struct wsp_htm_status {
	__u64	stat;
	__u64	last_offset;
};

/* Pass NULL enable args for default settings */
struct wsp_htm_enable_args {
	__u64	htm_mode;	/* Only some bits allowed */
	__u64	htm_ctrl;
	__u64	htm_filt;
};

#define WSP_HTM_IOC_API_VERSION		 _IO('H', 0)
#define WSP_HTM_IOC_ENABLE		_IOW('H', 1, struct wsp_htm_enable_args)
#define WSP_HTM_IOC_DISABLE		 _IO('H', 2)
#define WSP_HTM_IOC_START		 _IO('H', 3)
#define WSP_HTM_IOC_STOP		 _IO('H', 4)
#define WSP_HTM_IOC_GET_ORDER		 _IO('H', 5)
#define WSP_HTM_IOC_WAIT_COMPLETE	 _IO('H', 6)
#define WSP_HTM_IOC_RESET		 _IO('H', 7)
#define WSP_HTM_IOC_GET_STATUS 		_IOR('H', 8, struct wsp_htm_status)

#define WSP_HTM_API_VERSION_MAJOR	1
#define WSP_HTM_API_VERSION_MINOR	0

#define WSP_HTM_API_VERSION   ((WSP_HTM_API_VERSION_MAJOR << 16) | \
				  WSP_HTM_API_VERSION_MINOR)
#endif /* __WSP_HTM_H__ */
